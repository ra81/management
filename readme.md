# Management

## ВАЖНО
Если у вас есть другие скрипты изменяющие данные окна, то может работать некорректно. Алгоритм привязывается к 
расположению элементов по номерам в некоторых случаях, поэтому будет считывать другие данные.

## УСТАНОВКА
Зайдите в папку `management/out` и кликайте на `management.user.js` после чего кликайте на кнопку raw. Скрипт будет установле. При обновлении тамперманки его автоматом обновит у вас в браузере.

## Для чего?
Для игры виртономика. Это пользовательский скрипт. Написан на TypeScript и скомпилирован в JavaScript. Тестировался и проверялся на TamperMonkey.

## Что делает?
* На главную страницу юнитами (как свои юниты так и вражеские) выводит дополнительные фильтры:
	- фильтр по региону
	- фильтр по городу
	- фильтр по типу
	- фильтр по специализации
	- фильтр по проблемам
	- фильтр по эффективности
	- текстовый фильтр
* Если есть штатное меню фильтрации в виде выпадающего списка, то убирает его. Оно убого и тормозно работает. Помимо этого прячет большую жирную кнопку создания юнита выводя небольшую на панель со значками фильтров, если они у вас конечно появились. Если их нет, то кнопка остается где была.
* Эффективности меньше 100 выделяет красным.
* Позволяет в одну кнопку запросить все будущие эффективности юнитов.
* Так же добавляет возможно кликнув на цифру эффективности получить прогноз эффективности.

Фильтр ничего не удаляет со страницы, он лишь скрывает отфильтрованные строки.
Двойной клик по любому выпадающегому спису сбрасывает его в All и проводит сброс фильтрации.

### Фильтры по городу и региону
Тут все просто, выбирайте либо регион, и город в нем, либо сразу город. Регион будет подставлен автоматом. Эти два фильтра связаны между собой.
Типичные сценарии: вывести все юниты в регионе Х. Или все магазины в городе Х. 

### Фильтр по типу и специализации
Например нам нужно увидеть все Офисы рекламирующие Маточное молочко. Тогда ставим Тип: офис, а Тов: Маточное молочко. Получим то что нужно.

### Фильтр по проблемам
Хотим увидеть все магазины которые убыточные. Ставим Тип: магазин, а Алерт: Убыточное предприятие. Вуаля. Можно наложить фильтр региона, тогда получим ТОЛЬКО в заданном регионе.

### Фильтр по эффективности
Работает аналогично предыдущим с нюансами. 
- 100% выводит ТОЛЬКО полностью эффективные
- < 100% выводит все с проблемами КРОМЕ отпусков, только что построенных в общем неактивных по какой либо причине.
- 0% как раз выводит все оставшиеся. Склады, отпуски, и прочие у кого эффективность 0 или вообще нет.

### Кнопка GO
Хитрая кнопка, запускает опрос сервера по всем текущим отфильтрованным юнитам на предмет будущей эффективности. Вы можете фильтрануть все магазины и жмакнуть эту кнопку. Когда все бегающие полосочки завершатся, и кнопка снова активируется, можно продолжать работу. Опрос идет довольно медленно так как сервер не охотно дает информацию. Поэтому ждите до конца. Чаще раза в 5 минут на текущий момент тыкать смысла нет. данные не обновляются на сервере чаще раза в 5 минут.

### Текстовый фильтр
Работает на базе регулярных выражений, поэтому может заменить все указанные выше фильтры, ну может кроме фильтра по эффективности.

#### Простые фильтры
- магаз - выведет все магазины. Аналогично если вводить shop
- завод - все заводы типо Завод компьютерных аксессуаров, или Металлургический завод. 
- обувь - все юниты где в специализации есть обувь или в названии есть обувь
- убыточ - все убыточные подразделения.
- венесуэл - выведет все юниты в данном регионе
- диагност - выведет все диагностические центры.

Поиск производится по всем текстовым данным доступным для данного юнита. Поиск ведется по всем текстовым строкам из выпадающих фильтров, и дополнительно еще по категориям юнитов. Какие собственно есть категории?
- workshop - вообще любой завод, фабрика или что угодно со значком завода
- shop - все со значком магазина
- mill - мельницы
- farm - все фермы любого типа
- mine - все шахты

Категорий больше, но это основные важные. Буду пополнять по мере.

#### Как применять составные фильтры?
Обычный сценарий когда вам надо найти все магазины продающие товар в заданном регионе убыточные. выглядеть шаблон будет так:
```
(?=.*магаз)(?=.*канад)(?=.*стираль)(?=.*убыточ)
```
Фильтр найдет все магазины, в канаде, которые убыточны и продают стиральные машины. Собственно `(?=.*)` есть основной элементы. Подставляйте туда нужное слово, собирайте общее выражение и оно будет работать. Порядок блоков неважен. Я могу написать то что написал выше в любом порядке. Работать будет все равно.
Собственно писать полностью слова не нужно. Достаточно чтобы было можно уникально идентифицировать юнит.
